<project name="custom_rules" basedir=".">
  <property environment="env"/>
  <property name="env.ROS_DISTRO" value="groovy"/>
  <property name="env.ROS_PACKAGE_PATH" value="/opt/ros/${env.ROS_DISTRO}/share"/>
  <property name="source.libs.absolute.dir" location="${source.dir}/.." />

  <target name="-pre-build" depends="archive.xmlrpc, archive.ros_bootstrap, archive.ros_messages, archive.ros">
    <path id="project.all.jars.path">
      <path path="${toString:project.all.jars.path}"/>
      <fileset dir="${jar.libs.absolute.dir}">
        <include name="*.jar"/>
      </fileset>
    </path>
  </target>
  <target name="-pre-clean" depends="clean.xmlrpc, clean.ros_bootstrap, clean.ros_messages, clean.ros">
    <delete dir="${out.absolute.dir}/libs"/>
  </target>
  
  <target name="init.xmlrpc">
    <tstamp/>
    <mkdir dir="${out.absolute.dir}/libs/xmlrpc"/>
  </target>
  <target name="compile.xmlrpc" depends="init.xmlrpc">
    <javac srcdir="${source.libs.absolute.dir}/xmlrpc" destdir="${out.absolute.dir}/libs/xmlrpc">
      <classpath>
        <fileset dir="${jar.libs.absolute.dir}">
          <include name="**/*.jar"/>
        </fileset>
      </classpath>
    </javac>
  </target>
  <target name="archive.xmlrpc" depends="compile.xmlrpc">
    <jar jarfile="${jar.libs.absolute.dir}/xmlrpc.jar" update="true">
      <fileset dir="${out.absolute.dir}/libs/xmlrpc">
        <include name="**/*.class"/>
      </fileset>
      <fileset dir="${source.libs.absolute.dir}/xmlrpc">
        <include name="**/*.properties"/>
      </fileset>
    </jar>
  </target>
  <target name="clean.xmlrpc">
    <delete dir="${out.absolute.dir}/libs/xmlrpc"/>
    <delete file="${jar.libs.absolute.dir}/xmlrpc.jar"/>
  </target>

  <target name="init.ros_bootstrap">
    <tstamp/>
    <mkdir dir="${out.absolute.dir}/libs/ros_bootstrap"/>
  </target>
  <target name="compile.ros_bootstrap" depends="init.ros_bootstrap">
    <javac srcdir="${source.libs.absolute.dir}/ros_bootstrap" destdir="${out.absolute.dir}/libs/ros_bootstrap">
      <classpath>
        <fileset dir="${jar.libs.absolute.dir}">
          <include name="**/*.jar"/>
        </fileset>
      </classpath>
    </javac>
  </target>
  <target name="archive.ros_bootstrap" depends="compile.ros_bootstrap">
    <jar jarfile="${jar.libs.absolute.dir}/ros_bootstrap.jar" basedir="${out.absolute.dir}/libs/ros_bootstrap" includes="**/*.class" update="true"/>
  </target>
  <target name="clean.ros_bootstrap">
    <delete dir="${out.absolute.dir}/libs/ros_bootstrap"/>
    <delete file="${jar.libs.absolute.dir}/ros_bootstrap.jar"/>
  </target>

  <target name="init.ros_messages">
    <tstamp/>
    <mkdir dir="${out.absolute.dir}/libs/ros_messages"/>
  </target>
  <target name="generate.ros_messages" depends="init.ros_messages, archive.ros_bootstrap">
    <java classname="org.ros.internal.message.GenerateInterfaces">
      <arg value="${env.ROS_PACKAGE_PATH}"/>
      <arg value="${out.absolute.dir}/libs/ros_messages"/>
      <classpath>
        <fileset dir="${jar.libs.absolute.dir}">
          <include name="**/*.jar"/>
        </fileset>
      </classpath>
    </java>
  </target>
  <target name="compile.ros_messages" depends="generate.ros_messages">
    <javac srcdir="${out.absolute.dir}/libs/ros_messages" destdir="${out.absolute.dir}/libs/ros_messages">
      <classpath>
        <fileset dir="${jar.libs.absolute.dir}">
          <include name="**/*.jar"/>
        </fileset>
      </classpath>
    </javac>
  </target>
  <target name="archive.ros_messages" depends="compile.ros_messages">
    <jar jarfile="${jar.libs.absolute.dir}/ros_messages.jar" basedir="${out.absolute.dir}/libs/ros_messages" includes="**/*.class" update="true"/>
  </target>
  <target name="clean.ros_messages">
    <delete dir="${out.absolute.dir}/libs/ros_messages"/>
    <delete file="${jar.libs.absolute.dir}/ros_messages.jar"/>
  </target>

  <target name="init.ros">
    <tstamp/>
    <mkdir dir="${out.absolute.dir}/libs/ros"/>
  </target>
  <target name="compile.ros" depends="init.ros, archive.ros_bootstrap, archive.ros_messages, archive.xmlrpc">
    <javac srcdir="${source.libs.absolute.dir}/ros" destdir="${out.absolute.dir}/libs/ros">
      <classpath>
        <fileset dir="${jar.libs.absolute.dir}">
          <include name="**/*.jar"/>
        </fileset>
      </classpath>
    </javac>
  </target>
  <target name="archive.ros" depends="compile.ros">
    <jar jarfile="${jar.libs.absolute.dir}/ros.jar" basedir="${out.absolute.dir}/libs/ros" includes="**/*.class" update="true"/>
  </target>
  <target name="clean.ros">
    <delete dir="${out.absolute.dir}/libs/ros"/>
    <delete file="${jar.libs.absolute.dir}/ros.jar"/>
  </target>
</project>
